<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
<style>
  body {
    margin: 0;
  }
  #gameContainer {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background-image: url('Back.jpg');
    background-size: cover;
    background-position: center;
  }

  .person {
    position: absolute;
    background-size: 200%; /* Adjust the background size to show a random section */
    background-repeat: no-repeat;
  }

  #backgroundInput {
    position: fixed;
    top: 10px;
    left: 10px;
  }
</style>
</head>
<body>

<div id="gameContainer"></div>

<input type="file" id="backgroundInput" accept="image/*" />
<button id="downloadBtn" style="position: fixed; top: 10px; right: 10px;">Download Image</button>

<script>
  let backgroundImages = [`url('Back.jpg')`];

  document.getElementById('backgroundInput').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const newBackgroundImage = `url(${e.target.result})`;
        document.getElementById('gameContainer').style.backgroundImage = newBackgroundImage;
        backgroundImages.push(newBackgroundImage);
      };
      reader.readAsDataURL(file);
    }
  });

  let spawnMode = 'person';

  document.getElementById('gameContainer').addEventListener('click', (event) => {
    if (spawnMode) {
      const element = document.createElement('div');
      element.className = spawnMode;

      const randomBackgroundImage = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
      element.style.backgroundImage = randomBackgroundImage;

      element.style.backgroundPosition = `${Math.random() * 100}% ${Math.random() * 100}%`;
      
      element.style.left = `${event.clientX - 25}px`;
      element.style.top = `${event.clientY - 100}px`;

      // Set random width and height
      element.style.width = `${Math.random() * 30 + 50}px`;
      element.style.height = `${Math.random() * 60 + 140}px`;

      document.getElementById('gameContainer').appendChild(element);
      movePerson(element);
    }
  });

  function movePerson(person) {
    setInterval(() => {
      const direction = Math.random() > 0.5 ? 1 : -1;
      const currentLeft = parseFloat(person.style.left);
      const newLeft = currentLeft + (direction * Math.random() * 2);

      if (newLeft > 0 && newLeft < window.innerWidth - 10) {
        person.style.left = `${newLeft}px`;
      }
    }, 100);
  }

  document.getElementById('downloadBtn').addEventListener('click', () => {
    html2canvas(document.getElementById('gameContainer')).then(canvas => {
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/jpeg');
      link.download = 'game_image.jpeg';
      link.click();
    });
  });
</script>

</body>
</html>
